/***      Command CD 1.0n  Command Line CD Player.**      Copyright (C) 1998 - 1999 Qwer**      Homepage  http://member.nifty.ne.jp/~Qwer**      Mail      zap00365@nifty.ne.jp****      This source code is for Think C.****		main.c*/#include <stdio.h>#define			CDMaxTrack			99typedef struct CDDiskAddress{	short				Minute;	short				Second;	short				Frame;} CDDiskAddress,*CDDiskAddressPtr,**CDDiskAddressHandle;typedef struct CDDiskTOC{	short				DiskMaxTrack;	CDDiskAddress		DiskTotalTime;	CDDiskAddress		LeadOut;	CDDiskAddress		TrackStart[CDMaxTrack];	CDDiskAddress		TrackTime[CDMaxTrack];	long				TrackTotalFrame[CDMaxTrack];} CDDiskTOC,*CDDiskTOCPtr,**CDDiskTOCHandle;typedef struct CDNameTOC{	Str255				DiskName;	Str255				TrackName[CDMaxTrack];} CDNameTOC,*CDNameTOCPtr,**CDNameTOCHandle;typedef struct CDQSubcode{	short				CurrentStatus;	short				PlayMode;	short				ControlField;	short				CurrentTrack;	CDDiskAddress		DiskTime;	CDDiskAddress		TrackTime;} CDQSubcode,*CDQSubcodePtr,**CDQSubcodeHandle;//GlobalRoutinesshort				main				(void);//StaticRoutinesvoid				PrintTOC			(void);void				CommandLine			(short);//ExternRoutinesextern	OSErr		CDOpenDriver		(short,short*);extern	OSErr		CDDiskInDrive		(Boolean*,short);extern	OSErr		CDEjectDisk			(short);extern	OSErr		CDReadDiskTOC		(CDDiskTOCPtr,short);extern	OSErr		CDReadNameTOC		(CDDiskTOCPtr,CDNameTOCPtr);extern	OSErr		CDReadTheQSubcode	(CDQSubcodePtr,short);extern	OSErr		CDAudioTrackSearch	(CDDiskAddressPtr,Boolean,short);extern	OSErr		CDAudioPlay			(CDDiskAddressPtr,CDDiskAddressPtr,short);extern	OSErr		CDAudioPause		(Boolean,short);extern	OSErr		CDAudioStop			(short);extern	OSErr		CDAudioScan			(short,short);extern	OSErr		CDAudioControl		(short,short,short);extern	OSErr		CDReadAudioVolume	(short*,short*,short);extern	OSErr		CDGetSpindleSpeed	(short*,short);extern	OSErr		CDSetSpindleSpeed	(short,short);extern	OSErr		CDReadAudioData		(CDDiskAddressPtr,Ptr,long,short);//StaticMemoriesstatic	Boolean			GoodTOC;static	CDDiskTOC		DiskTOC;static	CDNameTOC		NameTOC;short main(void){	short				RefNum;	CDQSubcode			QCode;	short				i;	short				delta;	Boolean				InDrive;	OSErr				err;		printf("CommandLine CD Player.\n");	printf("Copyright ý 1999 Qwer.\n");	printf("\n\n\n");		if((err = CDOpenDriver(1,&RefNum)) == noErr){		printf("Driver ID delta (0) > ");		scanf("%d",&delta);		if(RefNum - delta <= -33 && RefNum - delta >= -39) RefNum -= delta;		printf("Driver %d Booted.\n\n",RefNum);				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){			if(InDrive == true){				GoodTOC = false;				if((err = CDReadDiskTOC(&DiskTOC,RefNum)) == noErr){					if((err = CDReadNameTOC(&DiskTOC,&NameTOC)) == noErr){						PtoCstr(NameTOC.DiskName);						for(i=0;i<DiskTOC.DiskMaxTrack;i++) PtoCstr(NameTOC.TrackName[i]);												GoodTOC = true;						PrintTOC();						CommandLine(RefNum);					}					else printf("CDReadNameTOC Err %d\n",err);				}				else printf("CDReadDiskTOC Err %d\n",err);			}			else printf("No disk in drive.\n");		}		else printf("CDDiskInDrive Err %d\n",err);	}	else printf("CDOpenDriver Err %d\n",err);	return(0);}/*main*/void PrintTOC(void){	short				i;		printf("Disk : %s\n",NameTOC.DiskName);	printf("Track count : %d\n",DiskTOC.DiskMaxTrack);	printf("Total time : min %3d,sec %3d,frm %3d\n",DiskTOC.DiskTotalTime.Minute,DiskTOC.DiskTotalTime.Second,DiskTOC.DiskTotalTime.Frame);	printf("Lead  Out  : min %3d,sec %3d,frm %3d\n",DiskTOC.LeadOut.Minute,DiskTOC.LeadOut.Second,DiskTOC.LeadOut.Frame);	printf("\n");		for(i=0;i<DiskTOC.DiskMaxTrack;i++){		printf("Track %2d : min %3d,sec %3d,frm %3d   '%s'\n",i+1,DiskTOC.TrackTime[i].Minute,DiskTOC.TrackTime[i].Second,DiskTOC.TrackTime[i].Frame,NameTOC.TrackName[i]);		}	return;}/*PrintTOC*/void CommandLine(short RefNum){	CDQSubcode			QSub;	CDDiskAddress		StartTime;	char				key[256];	Boolean				InDrive;	Boolean				done;	Boolean				PorR;	short				ForR;	short				vol;	short				vol2;	short				i;	OSErr				err;		done = false;			while(done == false){		printf("\nOK > ");		scanf("%s",&key);		switch(key[0]){			case 't':			//ReadTOC			case 'T':				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						GoodTOC = false;						if((err = CDReadDiskTOC(&DiskTOC,RefNum)) == noErr){							if((err = CDReadNameTOC(&DiskTOC,&NameTOC)) == noErr){								PtoCstr(NameTOC.DiskName);								for(i=0;i<DiskTOC.DiskMaxTrack;i++) PtoCstr(NameTOC.TrackName[i]);								GoodTOC = true;								PrintTOC();							}							else printf("CDReadNameTOC Err %d\n",err);						}						else printf("CDReadDiskTOC Err %d\n",err);					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err);				break;			case 'e':			//Eject			case 'E':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						err = CDEjectDisk(RefNum);						if(err != noErr) printf("CDEjectDisk Err %d\n",err);						else{							GoodTOC = false;							printf("Ejected.\n");						}					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err);				break;			case 's':			//Stop			case 'S':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						err = CDAudioStop(RefNum);						if(err != noErr) printf("CDAudioStop Err %d\n",err);						else printf("Stopped.\n");					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err); 				break;			case 'g':			//Play			case 'G':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						printf("Start time [min,sec,frm] > ");						scanf("%d,%d,%d",&StartTime.Minute,&StartTime.Second,&StartTime.Frame);												if(StartTime.Minute < 0) StartTime.Minute = 0;						if(StartTime.Minute > 74) StartTime.Minute = 74;						if(StartTime.Second < 0) StartTime.Second = 0;						if(StartTime.Second > 59) StartTime.Second = 59;						if(StartTime.Frame < 0) StartTime.Frame = 0;						if(StartTime.Frame > 74) StartTime.Frame = 74;												err = CDAudioPlay(&StartTime,nil,RefNum);						if(err != noErr) printf("CDAudioPlay Err %d\n",err);						else{							printf("Fix : min %3d,sec %3d,frm %3d\n",StartTime.Minute,StartTime.Second,StartTime.Frame);							printf("Played.\n");						}					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err); 				break;			case 'p':			//Pause			case 'P':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						printf("'p' to Pause,'r' to Resume > ");						scanf("%s",&key);						PorR = false;						switch(key[0]){							case 'p':							case 'P':								PorR = true;							case 'r':							case 'R':								err = CDAudioPause(PorR,RefNum);								if(err != noErr) printf("CDAudioPause Err %d\n",err);								else{									if(PorR == true) printf("Paused.\n");									else printf("Resumed.\n");								}								break;							default:								printf("Unknown Command...\n");								break;						}					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err); 				break;			case 'k':			//Scan			case 'K':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						printf("'f' to Forward,'r' to Reverse > ");						scanf("%s",&key);						ForR = -1;						switch(key[0]){							case 'f':							case 'F':								ForR = 1;							case 'r':							case 'R':								for(i=0;i<300;i++){									err = CDAudioScan(ForR,RefNum);									if(err != noErr){										printf("CDAudioScan Err %d\n",err);										break;									}								}								if(err == noErr){									if((err = CDReadTheQSubcode(&QSub,RefNum)) == noErr){										if((err = CDAudioPlay(&QSub.DiskTime,nil,RefNum)) == noErr){											if(ForR == 1) printf("Forward scanned.\n");											else printf("Reverse scanned.\n");										}									}									else printf("CDAudioScan Err %d\n",err);								}								break;							default:								printf("Unknown Command...\n");								break;						}					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err); 				break;			case 'c':			case 'C':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						err = CDReadTheQSubcode(&QSub,RefNum);						if(err != noErr) printf("CDReadTheQSubcode Err %d\n",err);						else{							printf("Current status %d\n",QSub.CurrentStatus);							printf("Play mode      %d\n",QSub.PlayMode);							printf("Control field  %d\n",QSub.ControlField);							printf("Current track  %d\n",QSub.CurrentTrack);							printf("D time : min %3d,sec %3d,frm %3d\n",QSub.DiskTime.Minute,QSub.DiskTime.Second,QSub.DiskTime.Frame);							printf("T time : min %3d,sec %3d,frm %3d\n",QSub.TrackTime.Minute,QSub.TrackTime.Second,QSub.TrackTime.Frame);							printf("QSubcode read.\n");						}					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err); 				break;			case 'v':			case 'V':				if(GoodTOC == false){					printf("Please read TOC.\n");					break;				}				if((err = CDDiskInDrive(&InDrive,RefNum)) == noErr){					if(InDrive == true){						err = CDReadAudioVolume(&vol,&vol2,RefNum);						if(err != noErr) printf("CDReadAudioVolume Err %d\n",err);						else{							printf("Left : %3d,Right : %3d\n",vol,vol2);							printf("Volume read.\n");						}												printf("Volume [0~255] > ");						scanf("%d",&vol);						if(vol < 0) vol = 0;						if(vol > 255) vol = 255;						err = CDAudioControl(vol,vol,RefNum);						if(err != noErr) printf("CDAudioControl Err %d\n",err);						else printf("Volume controlled.\n");					}					else printf("No disk in drive.\n");				}				else printf("CDDiskInDrive Err %d\n",err);				break;			case 'q':			case 'Q':				done = true;				break;			default:				printf("Unknown Command...\n");				printf("'t' : ReadTOC\n");				printf("'e' : Eject\n");				printf("'s' : Stop\n");				printf("'g' : Play\n");				printf("'p' : Pause\n");				printf("'k' : Scan\n");				printf("'c' : ReadQSubcode\n");				printf("'v' : Volume\n");				printf("'q' : Goodbye\n");				break;		}	}	printf("Goodbye...\n");	printf("Press 'return' to exit.\n");	return;}/*CommandLine*/